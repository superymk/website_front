<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="styles.css">
    <title>Omni-AI</title>
</head>

<body>
    

    <div class="page">
        <div class="page1">
            <div class="title-row">
                <h1>Omni-AI: Easiest & Best</h1>
                <h3>(Limitation: Support picture creations only at current)</h3>
            </div>
            <div class="input-row">
                <label style="font-size:16pt;">Input configurations and your goals below:</label>
                <form class="form" >
                    <div class="input-with-prompt">
                        <p>OpenAI API Key (see <a href="">aaa</a> for help):</p>
                        <textarea type="text" id="openai_api_key" name="openai_api_key" style="font-size:12pt; width:50%; max-width:100%;" rows="1" placeholder="Paste OpenAI API Key here"></textarea>
                    </div>
                    <div class="input-with-prompt">
                        <p>Replicate API Key (see <a href="">aaa</a> for help):</p>
                        <textarea type="text" id="replicate_api_key" name="replicate_api_key" style="font-size:12pt; width:50%; max-width:100%;" rows="1" placeholder="Paste Replicate API Key here"></textarea>
                    </div>
                    <div class="input-with-prompt">
                        <p>What do you want to do:</p>
                        <textarea type="text" id="user_input" name="user_input" style="font-size:12pt; width:50%; max-width:100%;" rows="4"
                            placeholder="What would you like to do?">I'd like to furnish a bedroom. Please suggest me some popular furniture. Then show me one photo of the bedroom furnished with these furniture.</textarea>
                    </div>
                </form>
                <button type="submit" id="btn_submit" style="width: 100px;">Submit</button>
            </div>
            <div class="output-row">
                <label for="ta_output" style="font-size:16pt;">Omni_AI Output:</label>
                <textarea id="ta_output" style="font-size:12pt; width:50%; max-width:100%;" rows="10" readonly></textarea>
            </div>
            <div class="row">
                <h3 style="color:red;">
                    Limitations: <br>
                    (1) SLOW. It takes ~40s to generate a story and one picture. <br>
                    (2) BUGGY. I'll improve the backend with my best effort!
                </h3>
            </div>
        </div>
        <div class="page2">
            <div class="column">
                <label for="chatgpt_output">ChatGPT-3.5 Output:</label>
                <textarea id="chatgpt_output" style="font-size:12pt; width:100%; max-width:100%; height:50%;"></textarea>
            </div>
            <div class="column">
                <label for="dalle_output">DALLE-API (not website) Output:</label>
                <img id="dalle_output" class="middle-image">
            </div>
            <!-- <div class="column">
                <img src="right-image.jpg" alt="Right image" class="right-image">
            </div> -->
        </div>
    </div>


    <script>
        const formEl = document.querySelector('.form');
        formEl.addEventListener('submit', event => {
            event.preventDefault();

            // Disable the submit button
            let btn_output = document.getElementById('btn_submit');
            btn_output.disabled = true;

            // Process request and response to the Omni-AI web service
            const formData = new FormData(formEl);
            const data = Object.fromEntries(formData);
            fetch('http://localhost:3000/query', {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain'
                },
                body: JSON.stringify(data)
            }).then((response) => response.json())
                .then((data) => {

                    let ta_output = document.getElementById('ta_output');

                    // Format output
                    let final_output = '';
                    let int_output_ctr = 1;
                    {
                        for (const str of data.outputs) {
                            final_output += '[Output ' + int_output_ctr.toString() + ']\n';
                            final_output += str + '\n\n\n';

                            int_output_ctr++;
                        }
                    }

                    ta_output.value = final_output;

                    // Enable the submit button
                    let btn_output = document.getElementById('btn_submit');
                    btn_output.disabled = false;
                });




            // Output chatgpt's result to the Omni-AI web service
            fetch('http://localhost:3000/query_chatgpt', {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain'
                },
                body: JSON.stringify(data)
            }).then((response) => response.json())
                .then((data) => {

                    let chatgpt_output = document.getElementById('chatgpt_output');

                    // Format output
                    chatgpt_output.value = data.outputs[0];;
                });



            // Output chatgpt's result to the Omni-AI web service
            fetch('http://localhost:3000/query_dalle', {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain'
                },
                body: JSON.stringify(data)
            }).then((response) => response.json())
                .then((data) => {

                    let dalle_output = document.getElementById('dalle_output');

                    // Format output
                    dalle_output.src = data.outputs[0];
                });

        }
        );
    </script>
</body>

</html>