<!DOCTYPE html>
<html lang="en-US">

<head>
    <title>Omni-AI</title>
</head>

<body>
    <h1>Omni-AI: Easiest & Best</h1>
    <h3>(Limitation: Support picture creations only at current)</h3>
    <form class="form">
        <label for="user_input">Query:</label>
        <textarea type="text" id="user_input" name="user_input" style="width:50%;font-size:14pt;" rows="10" cols="120"
            placeholder="What would you like to do?">I'd like to furnish a bedroom. Please suggest me some popular furniture. Then show me one photo of the bedroom furnished with these furniture.</textarea>
        <button type="submit" id="btn_submit">Submit</button>
    </form>
    <div>
        <label for="ta_output">Omni_AI Output:</label>
        <textarea id="ta_output" rows="30" cols="120" style="width:50%;font-size:14pt;"></textarea>
    </div>

    <script>
        const formEl = document.querySelector('.form');
        formEl.addEventListener('submit', event => {
            event.preventDefault();

            // Disable the submit button
            let btn_output = document.getElementById('btn_submit');
            btn_output.disabled = true;

            // Process request and response to the Omni-AI web service
            const formData = new FormData(formEl);
            const data = Object.fromEntries(formData);
            fetch('http://localhost:3000/query', {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain'
                },
                body: JSON.stringify(data)
            }).then((response) => response.json())
                .then((data) => {

                    let ta_output = document.getElementById('ta_output');

                    // Format output
                    let final_output = '';
                    let int_output_ctr = 1;
                    {
                        for (const str of data.outputs) {
                            final_output += '[Output ' + int_output_ctr.toString() + ']\n';
                            final_output += str + '\n\n\n';

                            int_output_ctr++;
                        }
                    }

                    ta_output.value = final_output;

                    // Enable the submit button
                    let btn_output = document.getElementById('btn_submit');
                    btn_output.disabled = false;
                });




            // Output chatgpt's result to the Omni-AI web service
            fetch('http://localhost:3000/query_chatgpt', {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain'
                },
                body: JSON.stringify(data)
            }).then((response) => response.json())
                .then((data) => {

                    let chatgpt_output = document.getElementById('chatgpt_output');

                    // Format output
                    chatgpt_output.value = data.outputs[0];;
                });



            // Output chatgpt's result to the Omni-AI web service
            fetch('http://localhost:3000/query_dalle', {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain'
                },
                body: JSON.stringify(data)
            }).then((response) => response.json())
                .then((data) => {

                    let dalle_output = document.getElementById('dalle_output');

                    // Format output
                    dalle_output.src = data.outputs[0];
                });

        }
        );
    </script>

    <h3 style="color:red;">
        Limitations: <br> 
        (1) SLOW. It takes ~40s to generate a story and one picture. <br> 
        (2) BUGGY. I'll improve the backend with my best effort!
    </h3>


    <div>
        <label for="chatgpt_output">ChatGPT-3.5 Output:</label>
        <textarea id="chatgpt_output" rows="30" cols="120" style="width:50%;font-size:14pt;"></textarea>
    </div>
    <div>
        <label for="dalle_output">DALLE Output:</label>
        <img id="dalle_output" width="500" height="600">
    </div>
</body>

</html>